<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2022-08-10 
 | Rendered using BloomReach Forge Maven Skin 3.1.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20220810" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Hippo CMS External Document Picker Base &#x2013; Developer's How-to: External Link Picker Button in the RichText Editor</title>
  <link rel="stylesheet" href="../css/forge-maven-skin-syntaxhighlighter-3.1.1.min.css"/>
  <link rel="stylesheet" href="../css/forge-maven-skin-3.1.1.min.css"/>
  <link rel="stylesheet" href="../css/site.css" />
  <link rel="stylesheet" href="../css/print.css" media="print" />
  <link rel="icon" type="image/png" href="../images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="../js/forge-maven-skin-syntaxhighlighter-3.1.1.min.js"></script>
  <script type="text/javascript" src="../js/forge-maven-skin-3.1.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/bloomreach-forge/external-document-picker">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="../images/skin/logo.png" alt="BloomReach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Hippo CMS External Document Picker Base</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://documentation.bloomreach.com">documentation.bloomreach.com</a>
      <a href="https://developers.bloomreach.com">developers.bloomreach.com</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 2022-08-10  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Main</li>
              <li>  <a href="../index.html" title="Welcome">  <span class="none"></span>  Welcome</a>  </li>
                                                                                  <li>  <a href="../openui-field/architecture.html" title="OpenUI Document Field">  <span class="icon-chevron-down"></span>  OpenUI Document Field</a>  
    <ul class="nav nav-list">
                  <li>  <a href="../openui-field/architecture.html" title="Architecture">  <span class="none"></span>  Architecture</a>  </li>
                        <li>  <a href="../openui-field/install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
                        <li>  <a href="../openui-field/dev-howto-openui-listview.html" title="OpenUI Flat List Picker">  <span class="none"></span>  OpenUI Flat List Picker</a>  </li>
                        <li>  <a href="../openui-field/dev-howto-openui-treeview.html" title="OpenUI Tree List Picker">  <span class="none"></span>  OpenUI Tree List Picker</a>  </li>
                        <li>  <a href="../openui-field/spec-of-rest-services.html" title="Specification of REST Services">  <span class="none"></span>  Specification of REST Services</a>  </li>
              </ul>
  </li>
                                                                                  <li>  <a href="../field/architecture.html" title="Document Field">  <span class="icon-chevron-down"></span>  Document Field</a>  
    <ul class="nav nav-list">
                  <li>  <a href="../field/architecture.html" title="Architecture">  <span class="none"></span>  Architecture</a>  </li>
                        <li>  <a href="../field/install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
                        <li>  <a href="../field/dev-howto-listview.html" title="Flat List Picker">  <span class="none"></span>  Flat List Picker</a>  </li>
                        <li>  <a href="../field/dev-howto-treeview.html" title="Tree List Picker">  <span class="none"></span>  Tree List Picker</a>  </li>
                        <li>  <a href="../field/dev-example-jpql.html" title="Example: JPA Picker">  <span class="none"></span>  Example: JPA Picker</a>  </li>
              </ul>
  </li>
                                                      <li>  <a href="../folder/architecture.html" title="Folder Context Menu">  <span class="icon-chevron-down"></span>  Folder Context Menu</a>  
    <ul class="nav nav-list">
                  <li>  <a href="../folder/architecture.html" title="Architecture">  <span class="none"></span>  Architecture</a>  </li>
                        <li>  <a href="../folder/dev-howto-listview.html" title="Flat List Picker">  <span class="none"></span>  Flat List Picker</a>  </li>
                        <li>  <a href="../folder/dev-howto-treeview.html" title="Tree List Picker">  <span class="none"></span>  Tree List Picker</a>  </li>
              </ul>
  </li>
                                                                  <li>  <a href="../richtext-ckeditor/architecture.html" title="RichText Editor">  <span class="icon-chevron-down"></span>  RichText Editor</a>  
    <ul class="nav nav-list">
                  <li>  <a href="../richtext-ckeditor/architecture.html" title="Architecture">  <span class="none"></span>  Architecture</a>  </li>
                        <li>  <a href="../richtext-ckeditor/install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
                        <li class="active">  <a href="#"><span class="none"></span>External Link Picker Button</a>
  </li>
              </ul>
  </li>
        <li>  <a href="../release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
        <li>  <a href="../apidocs/index.html" title="Javadoc">  <span class="none"></span>  Javadoc</a>  </li>
                  <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                                        <li>  <a href="../project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
                                                        <li>  <a href="../project-reports.html" title="Project Reports">  <span class="icon-chevron-right"></span>  Project Reports</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  
    <section>
<h2><a name="Developer.27s_How-to:_External_Link_Picker_Button_in_the_RichText_Editor"></a>Developer's How-to: External Link Picker Button in the RichText Editor</h2>

      <section>
<h3><a name="Configurations"></a>Configurations</h3>
        
<p>
          As explained in the <a href="install.html">Installation</a> page,
          all the configurations for the <b>exdocpickerbase</b> CKEditor plugin are set
          in the <b>ckeditor.config.appended.json</b> property
          (please see <a class="externalLink" href="http://www.onehippo.org/library/concepts/document-types/html-fields/ckeditor-configuration-properties.html" target="_blank">CKEditor configuration properties</a> for the detail on <b>ckeditor.config.appended.json</b> property.)
          like the following example:
        </p>
        
<div class="brush: javascript">
        
<div class="source"><pre>
{
  &quot;exdocpickerbase&quot; : {
    &quot;buttonLabel&quot; : &quot;Link to Hippo Blog Articles&quot;,
    &quot;buttonIcon&quot; : &quot;/cms/images/hippoblogpicker.png&quot;,
    &quot;dialogTitle&quot; : &quot;Hippo Blog Article Browser&quot;,
    &quot;dialogMinWidth&quot; : 640,
    &quot;dialogMinHeight&quot; : 480,
    &quot;defaultDocumentIcon&quot; : &quot;/cms/images/onehippo-default.png&quot;,
    &quot;getSearchURL&quot; : &quot;return '/cms/examples/hippoblogarticles.jsp?q=' + encodeURI(data.query);&quot;,
    &quot;getLinkAttributes&quot; : &quot;var attrs = {}; attrs['href'] = item.href; attrs['data-custom1'] = item['data-custom1']; return attrs;&quot;
  }
}
        </pre></div>
        </div>
        
<p>
          Here's the detail on each configuration:
        </p>
        
<table border="0" class="table table-striped">
          
<tr class="a">
            
<th>Property name</th>
            
<th>Description</th>
            
<th>Example value(s)</th>
            
<th>Default value(s)</th>
          </tr>
          
<tr class="b">
            
<td>buttonLabel</td>
            
<td>The label for the link button shown in the CKEditor.</td>
            
<td>&quot;Link to Hippo Blog Articles&quot;</td>
            
<td>&quot;Link to External Document&quot;</td>
          </tr>
          
<tr class="a">
            
<td>buttonIcon</td>
            
<td>The icon image URI for the link button shown in the CKEditor.</td>
            
<td>&quot;/cms/images/hippoblogpicker.png&quot;</td>
            
<td>exdocpickerbase.png</td>
          </tr>
          
<tr class="b">
            
<td>dialogTitle</td>
            
<td>The title of the external document searching popup dialog which is to show when user clicks on the link button.</td>
            
<td>&quot;Hippo Blog Article Browser&quot;</td>
            
<td>&quot;External Document Browser&quot;</td>
          </tr>
          
<tr class="a">
            
<td>dialogMinWidth</td>
            
<td>The minimum width of the external document searching popup dialog.</td>
            
<td>640</td>
            
<td>640</td>
          </tr>
          
<tr class="b">
            
<td>dialogMinHeight</td>
            
<td>The minimum height of the external document searching popup dialog.</td>
            
<td>480</td>
            
<td>480</td>
          </tr>
          
<tr class="a">
            
<td>defaultDocumentIcon</td>
            
<td>
              The default document icon image URI, which is used instead if <code>icon</code> property is empty in a document item JSON Object.
            </td>
            
<td>/cms/images/onehippo-default.png</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>getSearchURL</td>
            
<td>
              
<p>
                The function body string which is to be invoked by the plugin when user clicks on 'Search' button in the popup dialog.
              </p>
              
<p>
                This function body is responsible for returning a valid REST Service URL based on the search query term entered by the user.
                See the example implementation as shown above.
              </p>
              
<p>
                <b>Note: </b>
                The function body can expect 'data' object argument.
                An example 'data' object argument looks like '{ &quot;query&quot; : &quot;a_search_term&quot; }'.
                In other words, you can use 'data.query' in the function body to get the string input value in the search text box.
              </p>
            </td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>getLinkAttributes</td>
            
<td>
              
<p>
                The function body string which is to be invoked by the plugin when user selects an external document item after a search
                and clicks on OK button in order to set attributes of the (new) link element.
              </p>
              
<p>
                This function body is responsible for extracting attributes from a search result item and sets required/optional attributes in the generated link element (&lt;a ... &gt;).
                See the example implementation as shown above, which sets the &quot;data-custom1&quot; attribute as well as the normal &quot;href&quot; attribute.
              </p>
              
<p>
                <b>Note: </b>
                The function body can expect 'item' object argument.
                An example 'item' object argument is exactly the same as the selected item of the result list from your own REST service.
                So, you can use 'item.href' in the function body, for instance, to get the href attribute value from the search result item.
                <br />
                Please take a look at an example REST service output in the demo project here:
                <a class="externalLink" href="https://github.com/bloomreach-forge/external-document-picker/tree/master/demo/cms/src/main/webapp/examples/hippoblogarticles.jsp">https://github.com/bloomreach-forge/external-document-picker/tree/master/demo/cms/src/main/webapp/examples/hippoblogarticles.jsp</a>
              </p>
            </td>
            
<td></td>
            
<td></td>
          </tr>
        </table>
      </section>

      <section>
<h3><a name="Wait.21_Why_function_body_string_configurations_instead_of_JavaScript_function_itself.3F"></a>Wait! Why function body string configurations instead of JavaScript function itself?</h3>
        
<p>
          Good question! :) Yeah, it is a bit ugly with function body strings. :(
        </p>
        
<p>
          However, unfortunately, that's how we can handle it for <b>getSearchURL</b> and <b>getLinkAttributes</b>
          properties for now (at least until 7.9).
        </p>
        
<p>
          The reason is that the internal Hippo CMS7 CKEditor Plugin parses the custom CKEditor configurations to
          <code>org.json.JSONObject</code> objects first and merge them with other default properties in the Java code.
          So, it cannot handle JavaScript function object properly.
        </p>
        
<p>
          Therefore, a workaround solution came out to solve this problem:
          If you provide function body as string instead, then this CKEditor plugin creates JavaScript functions by using
          <a class="externalLink" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function">Function</a> constructor.
          That's why those function body string properties were born for this plugin.
        </p>
      </section>

      <section>
<h3><a name="Implementing_your_own_REST_Service_for_External_Document_Searches"></a>Implementing your own REST Service for External Document Searches</h3>
        
<p>
          You should provide a valid REST service URL in the <b>getSearchURL</b> function body property as shown above.
        </p>
        
<p>
          Please take a look at a very simple REST service implementation JSP page (residing in the demo project):
          <a class="externalLink" href="https://github.com/bloomreach-forge/external-document-picker/tree/master/demo/cms/src/main/webapp/examples/hippoblogarticles.jsp">https://github.com/bloomreach-forge/external-document-picker/tree/master/demo/cms/src/main/webapp/examples/hippoblogarticles.jsp</a>
        </p>
        
<p>
          Basically, your REST service implementation should return a JavaScript array, each item of which can be in any forms
          because it's totally up to you to extract attributes from each result item and set link attributes in the generated link
          in <b>getLinkAttributes</b> function body property.
        </p>
        
<p>
          Note 1: Because the REST service is invoked by client-side CKEditor plugin, the REST Service URL must be from the same origin
          in order to avoid security problems.
        </p>
        
<p>
          Note 2: If you want to secure your REST service which is not based on Apache Wicket components and/or
          if you want to get access to the same Wicket Session and JCR Session for the currently authenticated CMS user,
          then please refer to <a class="externalLink" href="https://bloomreach-forge.github.io/iframe-perspective/non-wicket-comp-pages.html" target="_blank">How to build secure non-Wicket-component based pages?</a>.
        </p>
      </section>

      <section>
<h3><a name="Handling_Custom_Links_in_Delivery_Tier"></a>Handling Custom Links in Delivery Tier</h3>
        
<p>
          Maybe you're also interested in having a custom behavior handling the links generated by this plugin.
          In that case, you might want to implement a custom <code>org.hippoecm.hst.content.rewriter.ContentRewriter</code>
          for that.
          Please refer to <a class="externalLink" href="http://www.onehippo.org/library/concepts/rewriting-rich-text-field-runtime/hst-2-rewriting-rich-text-field-runtime.html">HST-2 Rewriting rich text field runtime</a> page
          and its child pages for examples.
        </p>
      </section>

    </section>
  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2007&#x2013;2022
              <a href="https://www.bloomreach.com/">Bloomreach</a>.
          
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

